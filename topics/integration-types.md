## Введение

Интеграции связывают системы, данные и процессы. Чтобы выбирать подход осознанно, важно понимать основные виды интеграций, их особенности, плюсы и ограничения.
Это договорённость о данных, процессах, ответственности и гарантиях доставки между системами. Для системного аналитика интеграция почти всегда заканчивается набором артефактов: контракты, маппинги, сценарии, ошибки, статусы, ограничения и наблюдаемость.

**Интеграция** — согласованный обмен данными между 2+ системами.

**Интеграционный проект** — проект по созданию такой связки.

**Интеграционное решение** — выбранный подход/архитектура (API, брокер, ESB, файлы и т.д.).

**Требование** — проверяемое утверждение «что должно быть реализовано».

**Спецификация требований / ТЗ** — документ, где требования собраны и уточнены.

## Базовые критерии классификации

- **Уровень интеграции**: данные (обмен/репликация), процессы (оркестрация/хореография), интерфейс (встраивание виджетов/SSO), B2B (EDI/порталы/маркетплейсы).
- **Режим работы**: синхронный (запрос-ответ) vs асинхронный (очереди, события, отложенная доставка).
- **Транспорт/протокол**: HTTP (REST, SOAP, gRPC), очереди/стриминг (AMQP, MQTT, Kafka), файлы (SFTP/облако), прямой доступ к БД (DB links, CDC), специализированные (EDI/X12/EDIFACT), webhooks.
- **Архитектурный стиль**: point-to-point, hub-and-spoke, ESB, event-driven, API-first, iPaaS.

## Как системный аналитик классифицирует интеграции (минимум 4 оси)

### Уровень интеграции

* Данные: репликация/CDC/ETL (обновляем витрины, синхроним справочники)
* Процессы: оркестрация/хореография (собираем цепочку действий)
* Интерфейс: SSO, встраивание виджетов, deep links
* B2B: EDI/порталы/маркетплейсы (документооборот, контрагенты)

### Режим
* Синхронный (request/response): нужен ответ “сейчас”
* Асинхронный (сообщения/события): ответ может быть потом; важнее доставка/повторы
* Batch vs near real-time: «пакетами данных по расписанию» vs «почти сразу»

### Транспорт/протокол

* HTTP (REST/SOAP/gRPC)
* очереди/стриминг (AMQP/Kafka)
* файлы (SFTP/object storage)
* CDC
* webhooks
* EDI.

### Архитектурный стиль

* P2P, Hub-and-Spoke, ESB, Event-Driven, API-first, iPaaS

## Основные виды интеграций

### Point-to-Point (P2P)

Прямые вызовы между двумя системами / сервисами.

- **Плюсы**: минимум инфраструктуры, быстро стартовать
- **Минусы**: экспоненциальный рост связей, сложность версионирования, дублирование логики трансформаций

### Hub-and-Spoke / ESB

Центральная шина маршрутизирует, трансформирует и оркестрирует сообщения.

- **Плюсы**: единая точка политики, преобразований и мониторинга, снижается число прямых связей
- **Минусы**: риск «центрального узкого места», сложность/стоимость, возможная чрезмерная оркестрация

### Event-Driven (Pub/Sub, Streaming)

Обмен через события / сообщения через брокер (RabbitMQ, Kafka, NATS, Pulsar).

- **Плюсы**: слабая связанность, естественная масштабируемость, удобство аудита/реплея (стриминг)
- **Минусы**: сложнее отлаживать сквозные цепочки, требуется продуманная схемотека и управление версиями событий

Когда использовать:

* много потребителей одного факта (“заказ создан”, “платёж проведён”);
* нужно разгрузить синхронный контур;
* нужен аудит или стриминг данных.

Что зафиксировать до интеграции:

* название события, источник истины, когда публикуется
* ключ партиционирования (по чему гарантируем порядок)
* семантика доставки (at-least-once / at most once / exactly once)
* идемпотентность потребителя (как обрабатывать повторные сообщения/события/дубликаты)
* версионирование схем данных (совместимость)

### API-интеграции

REST/gRPC/SOAP, API Gateway, OAuth2/OIDC, rate limits.

- **Плюсы**: контрактность, хорошая управляемость безопасности и квот.
- **Минусы**: синхронность по умолчанию, чувствительность к задержкам и отказам; нужен продуманный lifecycle (версионирование, депрекейшн).

Что зафиксировать до интеграции:

* endpoint + вход/выход + ошибки
* authN/authZ (токены/роли/скоупы доступов)
* лимиты, таймауты, ретраи, дедлайны
* версионирование

### Webhooks и обратные вызовы

Система-отправитель дергает callback URL получателя.

Например, у нас есть система уведомлений, которая проверяет наличие новых уведомлений каждые 5 минут.
Если уведомления появились, система отправляет POST-запрос на callback URL внешней системы.

- **Плюсы**: простая реактивность без постоянного опроса "а есть новые уведомления?"
- **Минусы**: управление подписями/ретраями, защита от дубликатов, необходимость публичной доступности получателя

### Файловый обмен / SFTP / Object Storage

Передача CSV/XML/JSON «пакетами».

- **Плюсы**: простой, дешёвый, устойчив к временным сбоям сетей.
- **Минусы**: задержка, контроль версий схем, риск расхождений во временных зонах и кодировках.

### Репликация и CDC (Change Data Capture)

Подписка на журналы транзакций (Debezium, GoldenGate) для потоков данных.

- **Плюсы**: минимальное влияние на OLTP, высокая актуальность данных.
- **Минусы**: сложность маршрутизации/трансформации, необходимость строгой политики схем.

### ETL/ELT и батчевые загрузки

Периодические выгрузки, очистка, трансформация и загрузка в DWH/датамарты.

- **Плюсы**: предсказуемые окна, удобство тяжёлых трансформаций.
- **Минусы**: задержка данных, окна недоступности, риск «дрейфа» схем.

### iPaaS / Low-code интеграторы

Облачные коннекторы и визуальные флоу (MuleSoft, Boomi, Make, n8n, Power Automate).

- **Плюсы**: быстрое подключение SaaS, готовые адаптеры, визуальный мониторинг.
- **Минусы**: зависимость от вендора, стоимость, ограничения на сложные кейсы и производительность.

### B2B / EDI

Стандартизированный обмен документами (заказы, инвойсы, ASN) через VAN, SFTP или API.

- **Плюсы**: снижает ручной ввод и ошибки, юридически значимый документооборот.
- **Минусы**: жесткие форматы, долгие онбординги, необходимость маппинга под партнёров.

## Синхронность и надёжность

- **Синхронно**: запрос-ответ, важно время отклика; используйте таймауты, ретраи с джиттером, circuit breaker.
- **Асинхронно**: очереди/события, важно гарантировать доставку и порядок; применяйте идемпотентность, дедупликацию, DLQ, backoff.
- **Доставка**: at-most-once (без повторов, но с риском потери), at-least-once (повторы возможны), exactly-once (дорого/сложно, часто имитируется идемпотентностью).

## Что выбирать (шпаргалка)

- **Быстрые пользовательские запросы** → API (REST/gRPC) с кэшированием; критичное — добавьте async outbox для побочных эффектов.
- **Интеграция с SaaS/CRM/биллингом** → API/Webhooks или iPaaS, если нужно быстро и много коннекторов.
- **Высокая нагрузка, аналитика** → стриминг (Kafka/Pulsar) + DWH/OLAP; CDC для актуализации.
- **B2B-документы** → EDI/формализованные API; закладывайте маппинг и тестовые стенды партнёров.
- **Редкие, тяжёлые выгрузки** → SFTP/Object Storage + батч ETL.

## Риски и меры

- Версионирование контрактов (API/события/схемы), управление схемами (Schema Registry, OpenAPI).
- Наблюдаемость: корреляционные ID, трассировка (OpenTelemetry), метрики, алерты на ретраи/DLQ.
- Безопасность: аутентификация (OAuth2/OIDC), подписи webhook, шифрование в транзите и хранении, минимальные IAM-права.
- Управление SLA/SLO: таймауты, бюджет ошибок, политика деградации (graceful degradation).

## Краткое резюме

Нет «лучшего» вида интеграции. Выбор зависит от частоты и критичности операций, требований к задержке, консистентности, затрат и зрелости команды.
